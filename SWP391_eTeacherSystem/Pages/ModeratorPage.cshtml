@page
@model SWP391_eTeacherSystem.Pages.ModeratorPageModel
@{
}

<head>
	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">

	<title>Arsha Bootstrap Template - Index</title>
	<meta content="" name="description">
	<meta content="" name="keywords">

	<!-- Favicons -->
	<link href="~/img/favicon.png" rel="icon">
	<link href="~/img/apple-touch-icon.png" rel="apple-touch-icon">

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Jost:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

	<!-- Vendor CSS Files -->
	<link href="~/lib/aos/aos.css" rel="stylesheet">
	<link href="~/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="~/lib/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
	<link href="~/lib/boxicons/css/boxicons.min.css" rel="stylesheet">
	<link href="~/lib/glightbox/css/glightbox.min.css" rel="stylesheet">
	<link href="~/lib/remixicon/remixicon.css" rel="stylesheet">
	<link href="~/lib/swiper/swiper-bundle.min.css" rel="stylesheet">
	<link href="~/css/report.css" rel="stylesheet">
	<link href="~/css/style.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<!-- ======= Header ======= -->
<header id="header" class="fixed-top ">
	<div class="container d-flex align-items-center">
		<a class="nav-link scrollto active" asp-area="" asp-controller="CheckOut" asp-action="TutorPage"></a>

		<h1 class="logo me-auto"><a asp-page="/TutorPage">eTeacher</a></h1>

		<nav id="navbar" class="navbar">
			<ul>
				<li><a class="nav-link scrollto active" asp-page="/ModeratorPage">Home</a></li>
				<li><a class="nav-link scrollto active" href="#report">Report</a></li>
				<li><a class="nav-link scrollto active" href="#refund">Refund Requests</a></li>
				<li>
					<form method="post" asp-page-handler="Logout">
						<button type="submit" class="btnLogin-popup" style="margin-left=25px">Logout</button>
					</form>
				</li>
			</ul>
		</nav><!-- .navbar -->

	</div>
</header><!-- End Header -->
<!-- ======= Hero Section ======= -->
<section id="hero" class="d-flex align-items-center">

	<div class="container">
		<div class="row">
			<div class="col-lg-6 d-flex flex-column justify-content-center pt-4 pt-lg-0 order-2 order-lg-1" data-aos="fade-up" data-aos-delay="200">
				<h1>Better Solutions For Your Education</h1>
				<h2>We are team of talented tutors training better educators</h2>
				<div class="d-flex justify-content-center justify-content-lg-start">
					<a href="#about" class="btn-get-started scrollto">Get Started</a>
				</div>
			</div>
			<div class="col-lg-6 order-1 order-lg-2 hero-img" data-aos="zoom-in" data-aos-delay="200">
				<img src="~/img/pngegg.png" class="img-fluid animated" alt="">
			</div>
		</div>
	</div>

</section><!-- End Hero -->
<!-- ======= Manage Report Section ======= -->
<section id="report" class="report">
	<div class="container" data-aos="fade-up">

		<div class="section-title">
			<h2>Manage Report</h2>
		</div>

		<div class="row content">
			@if (Model.Reports != null && Model.Reports.Any())
			{
				<table class="table">
					<thead>
						<tr>
							<th>Report_id</th>
							<th>Class_id</th>
							<th>Title</th>
							<th>Processing</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var report in Model.Reports)
						{
							<tr>
								<td>@report.Report_id</td>
								<td>@report.Class_id</td>
								<td>@report.Title</td>
								<td>
									@if (report.Processing == 1)
									{
										<div class="row">
											<div class="col-lg-3">
												<span class="reportbg-warning-light">Pending</span>
											</div>
											<div class="col-lg-9">
												<form method="get" asp-page="/ManageReport">
													<input type="hidden" name="id" value="@report.Report_id" />
													<button type="submit" class="btn btn-success">Manage Report →</button>
												</form>
											</div>
										</div>
									}
									else if (report.Processing == 2)
									{
										<span class="reportbg-success-light">Approved</span>
									}
									else if (report.Processing == 3)
									{
										<span class="reportbg-danger-light">Reject</span>
									}
								</td>
							</tr>
						}
					</tbody>
				</table>
			}
			else
			{
				<p>No feedbacks founded.</p>
			}
		</div>
	</div>
</section>
<!-- ======= End Manage Report Section ======= -->
<!-- ======= Start Manage Refund ======-->
<section id="refund" class="refund">
	<div class="container" data-aos="fade-up">
		<div class="section-title">
			<h2>Refund Requests</h2>
		</div>
		<div class="row content">
			@if (Model.RefundRequests != null && Model.RefundRequests.Any())
			{
				<table class="table">
					<thead>
						<tr>
							<th>Order ID</th>
							<th>Class ID</th>
							<th>Student ID</th>
							<th>Total Sessions</th>
							<th>Presence Count</th>
							<th>Absence Count</th>
							<th>Remaining Sessions</th>
							<th>Amount</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var request in Model.RefundRequests)
						{
							var presenceCount = Model.GetPresenceCount(request.Class_id);
							var absenceCount = Model.GetAbsenceCount(request.Class_id);
							var remainingSessions = request.Class.Number_of_session - presenceCount;
							<tr>
								<td>@request.Order_id</td>
								<td>@request.Class_id</td>
								<td>@request.User_id</td>
								<td>@request.Class.Number_of_session</td>
								<td>@presenceCount</td>
								<td>@absenceCount</td>
								<td>@remainingSessions</td>
								<td>@request.Amount</td>
								<td>
									<form method="post" asp-page-handler="ApproveRefund" class="d-inline">
										<input type="hidden" name="orderId" value="@request.Order_id" />
										<button type="submit" class="btn btn-success custom-button">Approve</button>
									</form>
									<button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#rejectModal" data-order-id="@request.Order_id">Reject</button>
								</td>
							</tr>
						}
					</tbody>
				</table>
			}
			else
			{
				<p>No refund requests found.</p>
			}
		</div>
		<div class="section-title">
			<h2>Platform Earnings</h2>
			<p>Total earnings: @Model.PlatformEarnings</p>
		</div>
	</div>
</section>
<!-- ======= End Manage Refund ======-->
<!-- Vendor JS Files -->
<script src="~/lib/aos/aos.js"></script>
<script src="~/lib/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="~/lib/glightbox/js/glightbox.min.js"></script>
<script src="~/lib/isotope-layout/isotope.pkgd.min.js"></script>
<script src="~/lib/php-email-form/validate.js"></script>
<script src="~/lib/swiper/swiper-bundle.min.js"></script>
<script src="~/lib/waypoints/noframework.waypoints.js"></script>

<!-- Template Main JS File -->
<script src="~/js/main.js"></script>

<!-- Modal -->
<div class="modal fade" id="rejectModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h1 class="modal-title fs-5" id="staticBackdropLabel">Confirm Rejection</h1>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				Are you sure to refuse this student's refund?
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
				<form method="post" asp-page-handler="RejectRefund" id="rejectForm">
					<input type="hidden" name="orderId" id="rejectOrderId" value="" />
					<button type="submit" class="btn btn-primary">Yes</button>
				</form>
			</div>
		</div>
	</div>
</div>

<!-- Custom Script -->
<script>
	document.addEventListener('DOMContentLoaded', function () {
		var rejectModal = document.getElementById('rejectModal');
		rejectModal.addEventListener('show.bs.modal', function (event) {
			var button = event.relatedTarget;
			var orderId = button.getAttribute('data-order-id');
			var input = document.getElementById('rejectOrderId');
			input.value = orderId;
		});
	});
</script>